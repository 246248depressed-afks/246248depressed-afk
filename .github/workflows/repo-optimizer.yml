name: ğŸ”¥ Genesis Forge Pro â€“ Full Access AI Engineer

on:
  workflow_dispatch:
    inputs:
      target_owner:
        description: 'Ù…Ø§Ù„Ùƒ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‡Ø¯Ù'
        required: true
        type: string
      target_repo:
        description: 'Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‡Ø¯Ù'
        required: true
        type: string
      ai_prompt:
        description: 'Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø§Ù„Ù‚Ø§Ø¯Ù… Ù…Ù† Ù…Ù†ØµØªÙƒ'
        required: true
        type: string
      improvement_scope:
        description: 'Ù†Ø·Ø§Ù‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„'
        required: true
        type: choice
        options: [partial, full, refactor, security, performance, all]
        default: all
      base_branch:
        description: 'Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ'
        required: true
        default: main

permissions:
  contents: write
  pull-requests: write

env:
  DEEPSEEK_API_KEY: ${{ secrets.DEEPSEEK_API_KEY }}
  TARGET_TOKEN: ${{ secrets.TARGET_TOKEN }}

jobs:
  genesis-forge:
    runs-on: ubuntu-latest
    timeout-minutes: 45

    steps:
      - name: ğŸ” ÙØ­Øµ Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„ÙƒØ§Ù…Ù„
        run: |
          code=$(curl -s -o /dev/null -w "%{http_code}" \
            -H "Authorization: token $TARGET_TOKEN" \
            https://api.github.com/repos/${{ github.event.inputs.target_owner }}/${{ github.event.inputs.target_repo }})

          if [ "$code" != "200" ]; then
            echo "âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‡Ø¯Ù. Ø±Ù…Ø² Ø§Ù„Ø­Ø§Ù„Ø©: $code"
            exit 1
          fi
          echo "âœ… ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„ Ù…Ø¤ÙƒØ¯"

      - name: ğŸ“¥ Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‡Ø¯Ù (Full Access)
        uses: actions/checkout@v3
        with:
          repository: ${{ github.event.inputs.target_owner }}/${{ github.event.inputs.target_repo }}
          token: ${{ env.TARGET_TOKEN }}
          path: 'target' # Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ ÙÙŠ Ù…Ø¬Ù„Ø¯ Ø§Ø³Ù…Ù‡ target

      - name: âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Ù‡ÙˆÙŠØ© Git
        run: |
          cd target
          git config user.name "Genesis Forge AI"
          git config user.email "genesis-forge@ai.engineer"

      - name: ğŸ“Š ØªØ­Ù„ÙŠÙ„ Ø´Ø§Ù…Ù„ Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        run: |
          cd target
          echo "ğŸ“‚ Ø§Ù„Ù…Ù„ÙØ§Øª: $(find . -type f | wc -l)"
          echo "ğŸ“ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª: $(find . -type d | wc -l)"
          echo "ğŸ’¾ Ø§Ù„Ø­Ø¬Ù…: $(du -sh . | cut -f1)"

      - name: ğŸ§  Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª Ø¥Ù„Ù‰ DeepSeek (Ù…Ø¹Ø·Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹ Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
        run: |
          echo "Skipping DeepSeek call for this test run."
          # ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© Ù„Ø§Ø­Ù‚Ø§Ù‹
          # ... (ÙƒÙˆØ¯ curl Ø§Ù„Ø£ØµÙ„ÙŠ) ...

      # =================================================================
      # âœï¸ Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ§Ù„Ù…Ø¨Ø³Ø·Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
      # =================================================================
      - name: âœï¸ ØªØ·Ø¨ÙŠÙ‚ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· (Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±)
        run: |
          cd target
          echo "Hello from Genesis Forge AI - $(date)" >> README.md
          echo "Test modification applied."

      - name: ğŸ’¾ Commit Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        run: |
          cd target
          BRANCH_NAME="genesis-forge-ai-$(date +%s)"
          git checkout -b $BRANCH_NAME
          git add .
          if ! git diff --cached --quiet; then
            echo "ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§ØªØŒ Ø³ÙŠØªÙ… Ø¹Ù…Ù„ commit."
            git commit -m "ğŸ¤– AI Test Optimization via Genesis Forge"
            # ğŸš€ Push Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            git push origin $BRANCH_NAME
            # ğŸ”€ Ø¥Ù†Ø´Ø§Ø¡ Pull Request ØªÙ„Ù‚Ø§Ø¦ÙŠ
            curl -X POST \
              -H "Authorization: token ${{ env.TARGET_TOKEN }}" \
              -H "Accept: application/vnd.github+json" \
              https://api.github.com/repos/${{ github.event.inputs.target_owner }}/${{ github.event.inputs.target_repo }}/pulls \
              -d @- <<EOF
              {
                "title": "ğŸ¤– Genesis Forge AI Test (${{ github.run_id }})",
                "head": "$BRANCH_NAME",
                "base": "${{ github.event.inputs.base_branch }}",
                "body": "ØªØ¹Ø¯ÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ø¨Ø± AI Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø±ÙˆÙ…Ø¨Øª:\n\n> ${{ github.event.inputs.ai_prompt }}"
              }
EOF
          else
            echo "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ù„ØªØ·Ø¨ÙŠÙ‚Ù‡Ø§."
          fi

      - name: âœ… Ø§Ù„Ø®Ù„Ø§ØµØ©
        run: |
          echo "ğŸ”¥ Genesis Forge AI Ø£Ù†Ù‡Ù‰ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­"
          echo "ğŸ” ÙˆØµÙˆÙ„ ÙƒØ§Ù…Ù„"
          echo "ğŸ§ª ØªØ¹Ø¯ÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø±ÙŠ Ø¨Ø³ÙŠØ· ØªÙ… ØªØ·Ø¨ÙŠÙ‚Ù‡"
          echo "ğŸ“¦ Commit + PR ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ†Ø§ Ø¬Ø§Ù‡Ø²ÙŠÙ† (Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª ØªØºÙŠÙŠØ±Ø§Øª)"

